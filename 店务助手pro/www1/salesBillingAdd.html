<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title></title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0" />
</head>
<body>
	<style type="text/css">
		#salesBillingAddPostBox .lineBox{width:80px;}
		#salesBillingAddPostBox .ui-input-text{margin:3px 0px;}
		.salesBillingTd{text-align: center; background-color:#f8f9f9;}
		.th .salesBillingTd{background-color: #BEBEBE;}
		.salesBillingTd .lineBox{width:98%;}
	</style>
	<link href="css/mobiscroll.custom-2.6.2.min.css" rel="stylesheet" type="text/css" />
	<script src="js/mobiscroll.custom-2.6.2.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		uiOPT();
		setTimeout(function(){
			$.mobile.loading('show');
		},100);
		var PriceType   = 'zeroGrantPrice';
		var productList = GLOBALS['ProductList'];
	</script>
	<div class="toolBar">
		<a class="toolBar-a" id="salesBillingAddSaveButton">保存</a>
		<a class="toolBar-a" data-transition="slide" href="customerAdd.html">新增客户</a>
		<a class="toolBar-a" id="salesBillingAddScan" onclick="scan()">扫描开单</a>
		<a class="toolBar-a goBack"><span>« </span>返回</a>
		<div class="botton-box" id="salesBillingAddSelectButton">
			<a t="zeroGrantPrice" c="l-btn" class="l-btn botton-box-checked">批发价</a>
			<a t="packagePrice" c="m-btn" class="m-btn">打包价</a>
			<a t="retailPrice" c="r-btn" class="r-btn">零售价</a>
		</div>
	</div>

	<div id='salesBillingAddPostBox'>
	<div class="searchBox">
		店员：<div class="lineBox" style="width: 192px;"><input type="text" id="manager" class="post-data glb-text" /></div>
		现金：<div class="lineBox"><input type="text" value="0" id="cash" class="post-data glb-text" /></div>
		应付：<div class="lineBox"><input type="text" value="0" id="amount" class="post-data glb-text"  readonly="readonly" /></div>
		总件：<div class="lineBox"><input type="text" value="0" readonly="readonly" id="counts" class="post-data glb-text" /></div>
	</div>
	<div class="searchBox">
		客户：<div class="lineBox" style="width: 192px;"><input type="text" id="customer" class="post-data glb-text" /></div>
		刷卡：<div class="lineBox"><input type="text" value="0" id="card" class="post-data glb-text" /></div>
		实付：<div class="lineBox"><input type="text" value="0" id="actually" class="post-data glb-text"  readonly="readonly" /></div>
		总价：<div class="lineBox"><input type="text" value="0" readonly="readonly" id="totalprice" class="post-data glb-text" /></div>
	</div>
	<div class="searchBox">
		日期：<div class="lineBox" style="width:192px"><input readonly="readonly" placeholder="点击选择" type="text" id="selecttime" class="post-data glb-text" /></div>
		汇款：<div class="lineBox"><input type="text" value="0" id="remit" class="post-data glb-text" /></div>
		<div style="display: inline-block; width:100px;"><input type="text" value="0.00" id="moling" class="post-data glb-text" /></div>
		<a class="toolBar-a" id="moling_btn">抹零</a>
		备注：<div class="lineBox" style="width:100px;"><input type="text" id="remark" class="post-data glb-text" /></div>
	</div>
	</div>

	<div id="salesBillingAddscrollBox" class="scrollBox" style="padding:20px 8px; overflow:hidden;">
		<table border="0" cellpadding="2" cellspacing="0">
			<tr class="th">
				<td c lass="salesBillingTd" style="width:32px;">序号</td>
				<td class="salesBillingTd" style="width:140px;">货品</td>
				<td class="salesBillingTd" style="width:60px;">颜色</td>
				<td class="salesBillingTd" style="width:60px;">尺码</td>
				<td class="salesBillingTd" style="width:60px;">数量</td>
				<td class="salesBillingTd" style="width:60px;">单价</td>
				<td class="salesBillingTd" style="width:60px;">小计</td>
				<td class="salesBillingTd" style="width:60px;">备注</td>
				<td class="salesBillingTd" style="width:60px;">操作</td>
			</tr>
		</table>

		<div id="salesBillingAddscrollBoxA" style="position: relative;">
		<div style="padding-bottom:300px;">
		<table border="0" cellpadding="2" cellspacing="0">
			<tr>
				<td class="salesBillingTd" style="width:32px;text-align: center;">1<input type="hidden" value="1" postInput="number" /></td>
				<td class="salesBillingTd" style="width:140px;">
					<div class="lineBox"><input type="text" postInput="product" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="color" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="size" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="counts" class="post-data glb-text" placeholder="0" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="unitprice" class="post-data glb-text" placeholder="0"  /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="0" readonly="readonly" postInput="subtotal" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="remark" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;"><a class="toolBar-a dpdelBtns">删除</a></td>
			</tr>
			<tr>
				<td class="salesBillingTd" style="width:32px;text-align: center;">2<input type="hidden" value="2" postInput="number" /></td>
				<td class="salesBillingTd" style="width:140px;">
					<div class="lineBox"><input type="text" postInput="product" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="color" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="size" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="counts" class="post-data glb-text" placeholder="0" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="unitprice" class="post-data glb-text" placeholder="0"  /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="0" readonly="readonly" postInput="subtotal" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="remark" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;"><a class="toolBar-a dpdelBtns">删除</a></td>
			</tr>
			<tr>
				<td class="salesBillingTd" style="width:32px;text-align: center;">3<input type="hidden" value="3" postInput="number" /></td>
				<td class="salesBillingTd" style="width:140px;">
					<div class="lineBox"><input type="text" postInput="product" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="color" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="size" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="counts" class="post-data glb-text" placeholder="0" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="unitprice" class="post-data glb-text" placeholder="0"  /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="0" readonly="readonly" postInput="subtotal" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="remark" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;"><a class="toolBar-a dpdelBtns">删除</a></td>
			</tr>
			<tr>
				<td class="salesBillingTd" style="width:32px;text-align: center;">4<input type="hidden" value="4" postInput="number" /></td>
				<td class="salesBillingTd" style="width:140px;">
					<div class="lineBox"><input type="text" postInput="product" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="color" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="size" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="counts" class="post-data glb-text" placeholder="0" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="unitprice" class="post-data glb-text" placeholder="0"  /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="0" readonly="readonly" postInput="subtotal" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="remark" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;"><a class="toolBar-a dpdelBtns">删除</a></td>
			</tr>
			<tr>
				<td class="salesBillingTd" style="width:32px;text-align: center;">5<input type="hidden" value="5" postInput="number" /></td>
				<td class="salesBillingTd" style="width:140px;">
					<div class="lineBox"><input type="text" postInput="product" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="color" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="size" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="counts" class="post-data glb-text" placeholder="0" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="unitprice" class="post-data glb-text" placeholder="0"  /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="0" readonly="readonly" postInput="subtotal" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="remark" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;"><a class="toolBar-a dpdelBtns">删除</a></td>
			</tr>
			<tr>
				<td class="salesBillingTd" style="width:32px;text-align: center;">6<input type="hidden" value="6" postInput="number" /></td>
				<td class="salesBillingTd" style="width:140px;">
					<div class="lineBox"><input type="text" postInput="product" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="color" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="size" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="counts" class="post-data glb-text" placeholder="0" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="unitprice" class="post-data glb-text" placeholder="0"  /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="0" readonly="readonly" postInput="subtotal" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="remark" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;"><a class="toolBar-a dpdelBtns">删除</a></td>
			</tr>
			<tr>
				<td class="salesBillingTd" style="width:32px;text-align: center;">7<input type="hidden" value="7" postInput="number" /></td>
				<td class="salesBillingTd" style="width:140px;">
					<div class="lineBox"><input type="text" postInput="product" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="color" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="size" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="counts" class="post-data glb-text" placeholder="0" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="unitprice" class="post-data glb-text" placeholder="0"  /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="0" readonly="readonly" postInput="subtotal" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="remark" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;"><a class="toolBar-a dpdelBtns">删除</a></td>
			</tr>
			<tr>
				<td class="salesBillingTd" style="width:32px;text-align: center;">8<input type="hidden" value="8" postInput="number" /></td>
				<td class="salesBillingTd" style="width:140px;">
					<div class="lineBox"><input type="text" postInput="product" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="color" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="size" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="counts" class="post-data glb-text" placeholder="0" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="unitprice" class="post-data glb-text" placeholder="0"  /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="0" readonly="readonly" postInput="subtotal" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="remark" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;"><a class="toolBar-a dpdelBtns">删除</a></td>
			</tr>
			<tr>
				<td class="salesBillingTd" style="width:32px;text-align: center;">9<input type="hidden" value="9" postInput="number" /></td>
				<td class="salesBillingTd" style="width:140px;">
					<div class="lineBox"><input type="text" postInput="product" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="color" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="size" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="counts" class="post-data glb-text" placeholder="0" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="unitprice" class="post-data glb-text" placeholder="0"  /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="0" readonly="readonly" postInput="subtotal" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="remark" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;"><a class="toolBar-a dpdelBtns">删除</a></td>
			</tr>
			<tr>
				<td class="salesBillingTd" style="width:32px;text-align: center;">10<input type="hidden" value="10" postInput="number" /></td>
				<td class="salesBillingTd" style="width:140px;">
					<div class="lineBox"><input type="text" postInput="product" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="color" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="size" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="counts" class="post-data glb-text" placeholder="0" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="unitprice" class="post-data glb-text" placeholder="0"  /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="0" readonly="readonly" postInput="subtotal" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="remark" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;"><a class="toolBar-a dpdelBtns">删除</a></td>
			</tr>
			<tr>
				<td class="salesBillingTd" style="width:32px;text-align: center;">11<input type="hidden" value="11" postInput="number" /></td>
				<td class="salesBillingTd" style="width:140px;">
					<div class="lineBox"><input type="text" postInput="product" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="color" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="size" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="counts" class="post-data glb-text" placeholder="0" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="unitprice" class="post-data glb-text" placeholder="0"  /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="0" readonly="readonly" postInput="subtotal" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="remark" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;"><a class="toolBar-a dpdelBtns">删除</a></td>
			</tr>
			<tr>
				<td class="salesBillingTd" style="width:32px;text-align: center;">12<input type="hidden" value="12" postInput="number" /></td>
				<td class="salesBillingTd" style="width:140px;">
					<div class="lineBox"><input type="text" postInput="product" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="color" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="点击选择" readonly="readonly" postInput="size" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="counts" class="post-data glb-text" placeholder="0" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="unitprice" class="post-data glb-text" placeholder="0"  /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" placeholder="0" readonly="readonly" postInput="subtotal" class="post-data glb-text"/></div>
				</td>
				<td class="salesBillingTd" style="width:60px;">
					<div class="lineBox"><input type="text" postInput="remark" class="post-data glb-text" /></div>
				</td>
				<td class="salesBillingTd" style="width:60px;"><a class="toolBar-a dpdelBtns">删除</a></td>
			</tr>
		</table>
		</div>
		</div>
	</div>

<!--设置UI-->
<script type="text/javascript">
	$(function(){
		// 设置高度
		var resize = function(){
			var CXT_HEIGHT = $(window).height() - 41 - 48 - (48 * 3) - 20;
			$("#salesBillingAddscrollBoxA").height(CXT_HEIGHT);
		}
		resize();

		// 浏览器改变大小自动重新设置高度
		$(window).resize(function(){
			resize();
		});

		//数据块可以移动
		var salesBillingpScroll;
		setTimeout(function(){
			salesBillingpScroll = new iScroll('salesBillingAddscrollBoxA');
			salesBillingpScroll.refresh();
		},100);

		$(document).bind( "pageshow", function( event, prevPage){
			if(salesBillingpScroll !== undefined){
				salesBillingpScroll.refresh();
			}
		});

		// 时间控件
        var curr = new Date().getFullYear();
		var opt = {
	        preset: 'date', //日期
	        display: 'modal', //显示方式 
	        mode: 'scroller', //日期选择模式
	        dateFormat: 'yy-mm-dd', // 日期格式
	        setText: '确定', //确认按钮名称
	        cancelText: '取消',//取消按钮名籍我
	        dateOrder: 'yymmdd', //面板中日期排列格式
	        dayText: '日', monthText: '月', yearText: '年', //面板中年月日文字
	        endYear:2020 //结束年份
	    };
		$("#selecttime").mobiscroll(opt).date(opt);

		// 返回
		$(".goBack").tap(function(){
		    window.history.back();
		    return false;
		});

		var date = function(){
			var d = new Date();
			var str = d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();
			return str;
		}
		$('#salesBillingAddPostBox #selecttime').val(date());

		setTimeout(function(){
			$.mobile.loading('hide');
		},400);
	});
</script>

<!--数据操作-->
<script type="text/javascript">
	$(function(){
		$('#salesBillingAddscrollBoxA input[postInput="product"]').bind('input propertychange',function(){
			$.smartTips.show({
				trigger 	: 	$(this),
				data 		: 	productList,
				field		: 	Array('id','code','name'),
				attr		: 	Array('zeroGrantPrice','code','packagePrice','retailPrice','purchasePrice'),
				key			: 	'name',
				callback	: 	function(el,item){
					var parent 		= el.parent().parent().parent().parent(),
						unitprice	= parent.find('input[postInput="unitprice"]');
					unitprice.val(item.attr('zeroGrantPrice'));
					unitprice.attr('zeroGrantPrice',item.attr('zeroGrantPrice'));
					unitprice.attr('packagePrice',item.attr('packagePrice'));
					unitprice.attr('retailPrice',item.attr('retailPrice'));
					unitprice.attr('purchasePrice',item.attr('purchasePrice'));
					unitprice.blur(function(){
						if((parseInt($(this).val())) < (parseInt(item.attr('purchasePrice')))){
							$(this).val(item.attr('zeroGrantPrice'));
						}
					});
				}
			});
		});

		// 删除数据
		$('.dpdelBtns').bind('tap',function(){
			var tr = $(this).parent().parent();
			tr.find('input').val('');
			statistics();
		});

		// 统计总价，总件数
		var statistics = function(){
			var counts = 0,
				money  = 0;

			$('#salesBillingAddscrollBoxA input[postInput="counts"]').each(function(){
				if(!isNaN($(this).val()) && $(this).val().length > 0){
					counts = parseInt(counts) + parseInt($(this).val());
				}
			});

			$('#salesBillingAddscrollBoxA input[postInput="subtotal"]').each(function(){
				if(!isNaN($(this).val()) && $(this).val().length > 0){
					money = parseFloat(money) + parseFloat($(this).val());
				}
			});

			$('#salesBillingAddPostBox #counts').val(counts);
			$('#salesBillingAddPostBox #totalprice').val(money);
			$('#salesBillingAddPostBox #amount').val(money);
		}

		// 实付
		var payment	   	= function(){

			var cashVal 	= parseFloat($('#salesBillingAddPostBox #cash').val()),
				cardVal		= parseFloat($('#salesBillingAddPostBox #card').val()),
				remitVal 	= parseFloat($('#salesBillingAddPostBox #remit').val());

			var cash   		= (!isNaN(cashVal))  ? cashVal  : 0,
				card		= (!isNaN(cardVal))  ? cardVal  : 0,
				remit		= (!isNaN(remitVal)) ? remitVal : 0;

			$('#salesBillingAddPostBox #actually').val(cash + card + remit);
		}

		// 现金
		$('#salesBillingAddPostBox #cash').bind('input propertychange',function(){
			//
			payment();
		});

		// 刷卡
		$('#salesBillingAddPostBox #card').bind('input propertychange',function(){
			//
			payment();
		});

		// 汇款
		$('#salesBillingAddPostBox #remit').bind('input propertychange',function(){

			payment();
		});

		// 数量添加
		$('#salesBillingAddscrollBoxA input[postInput="counts"]').bind('input propertychange',function(){
			var parent 		= $(this).parent().parent().parent().parent(),
				subtotal	= parent.find('input[postInput="subtotal"]'),
				unitprice	= parent.find('input[postInput="unitprice"]');

			subtotal.val(unitprice.val() * $(this).val());
			statistics();
		});

		// 调整单价
		$('#salesBillingAddscrollBoxA input[postInput="unitprice"]').bind('input propertychange',function(){
			var parent 		= $(this).parent().parent().parent().parent(),
				subtotal	= parent.find('input[postInput="subtotal"]'),
				counts		= parent.find('input[postInput="counts"]');

			subtotal.val(counts.val() * $(this).val());
			statistics();
		});

		// 价格选择
		$('#salesBillingAddSelectButton a').tap(function(){
			$('#salesBillingAddSelectButton a').each(function(){
				$(this).attr('class',$(this).attr('c'));
			});
			$(this).attr('class',$(this).attr('class') + " botton-box-checked");
			PriceType = $(this).attr('t');

			$('.salesBillingTd').find('input[postinput="unitprice"]').each(function(){
				if(!isNaN(parseInt($(this).val()))){
					$(this).val($(this).attr(PriceType));
					var parent 		= $(this).parent().parent().parent().parent(),
						subtotal	= parent.find('input[postInput="subtotal"]'),
						counts		= parent.find('input[postInput="counts"]');

					subtotal.val(counts.val() * $(this).val());
					statistics();
				}
			});
		});


		// // 获取所有颜色
		// var colorList 	= undefined,
		// 	colorInput	= undefined;
		// $.get(SERVER + 'Color/GetList?token=' + TOKEN,function(data){
		// 	var data = eval("("+data+")");
		// 	// 颜色选择框
		// 	var colorBubbleList = $.bubbleList({
		// 		parent: $('body'),
		// 		data  : data.Result.Color,
		// 		bindCallFun: function(item,data){
		// 			item.text(data.color);
		// 		},
		// 		selectCallFun:function(item){
		// 			colorInput.val(item.text());
		// 			$('bubblebox').hide();
		// 		}
		// 	});
		// 	// 显示
		// 	$('#salesBillingAddscrollBoxA input[postInput="color"]').focus(function(){
		// 		colorInput = $(this);
		// 		colorBubbleList.show($(this));
		// 	});
		// });

		$('#salesBillingAddscrollBoxA input[postInput="size"]').focus(function(){
			var tr = $(this).parent().parent().parent().parent();
			var pd = tr.find('input[postinput="product"]');
			if(pd.val() == '') return false;
			var info = pd.val().split('/');
			var id = info[0];
			var size = '';
			for(var i in GLOBALS['ProductList']){
				if(id == GLOBALS['ProductList'][i].id){
					size = GLOBALS['ProductList'][i].size.split(',');
				}
			}
			setGlobalDDL(size,$(this));
		});

		$('#salesBillingAddscrollBoxA input[postInput="color"]').focus(function(){
			var tr = $(this).parent().parent().parent().parent();
			var pd = tr.find('input[postinput="product"]');
			if(pd.val() == '') return false;
			var info = pd.val().split('/');
			var id = info[0];
			var color = '';
			for(var i in GLOBALS['ProductList']){
				if(id == GLOBALS['ProductList'][i].id){
					color = GLOBALS['ProductList'][i].color.split(',');
				}
			}
			setGlobalDDL(color,$(this));
		});

		// // 获取所有尺寸
		// var sizeList 	= undefined,
		// 	sizeInput 	= undefined;
		// $.get(SERVER + 'Size/GetList?token=' + TOKEN,function(data){
		// 	var data = eval("("+data+")");
		// 	// 尺寸选择框
		// 	var sizeBubbleList = $.bubbleList({
		// 		parent: $('body'),
		// 		data  : data.Result.Size,
		// 		bindCallFun: function(item,data){
		// 			item.text(data.size);
		// 		},
		// 		selectCallFun:function(item){
		// 			sizeInput.val(item.text());
		// 			$('bubblebox').hide();
		// 		}
		// 	});
		// 	// 显示
		// 	$('#salesBillingAddscrollBoxA input[postInput="size"]').focus(function(){
		// 		sizeInput = $(this);
		// 		sizeBubbleList.show($(this));
		// 	});
		// });

		// // 客户选择器
		// var customerInput = undefined;
		// var customerBubbleList = $.bubbleList({
		// 		parent: $('body'),
		// 		data  : GLOBALS['CustomerList'],
		// 		bindCallFun: function(item,data){
		// 			item.text(data.customerName);
		// 		},
		// 		selectCallFun:function(item){
		// 			customerInput.val(item.text());
		// 			$('bubblebox').hide();
		// 		}			
		// });

		// // 员工选择器
		// var userInput = undefined;
		// var userBubbleList = $.bubbleList({
		// 		parent: $('body'),
		// 		data  : GLOBALS['UserList'],
		// 		bindCallFun: function(item,data){
		// 			item.text(data.name);
		// 		},
		// 		selectCallFun:function(item){
		// 			userInput.val(item.text());
		// 			$('bubblebox').hide();
		// 		}			
		// });

		$('#salesBillingAddPostBox #customer').focus(function(){
			CustomerInput = $(this);
			CustomerBubbleList.show($(this));
		});

		$('#salesBillingAddPostBox #manager').focus(function(){
			UserInput = $(this);
			UserBubbleList.show($(this));
		});		


		// 填充款速购买
		var isV = function(){
			// 遍历购物车
			var line = 12,
				c    = 0;
			for(var i in CartList){
				// 遍历产品队列中产品
				for(var q in CartList[i]){
					// 如果产品数量不为0
					if(CartList[i][q].count > 0){
						// 遍历产品列表，填充数据
						for(var x in GLOBALS['ProductList']){
							if (i == GLOBALS['ProductList'][x].id){
								//console.log(GLOBALS['ProductList'][x]);
								var tr = $('#salesBillingAddscrollBoxA').find('tr').eq(c);
								if(c > 12){
									tr = $('#salesBillingAddscrollBoxA').find('tr').eq(0);
									tr.clone(true).appendTo('#salesBillingAddscrollBoxA table');
									tr.find('input[postInput="number"]').val(c + 1);
									//tr.children('td').eq(0).text(c + 1);
								}
								
								var pc = GLOBALS['ProductList'][x].id + "/" + GLOBALS['ProductList'][x].code + "/" + GLOBALS['ProductList'][x].name + "/"; 
								tr.find('input[postInput="product"]').val(pc);
								tr.find('input[postInput="color"]').val(CartList[i][q].color);
								tr.find('input[postInput="size"]').val(CartList[i][q].size);
								tr.find('input[postInput="counts"]').val(CartList[i][q].count);
								tr.find('input[postinput="unitprice"]').val(GLOBALS['ProductList'][x].zeroGrantPrice);
								tr.find('input[postinput="unitprice"]').attr('zeroGrantPrice',GLOBALS['ProductList'][x].zeroGrantPrice);
								tr.find('input[postinput="unitprice"]').attr('packagePrice',GLOBALS['ProductList'][x].packagePrice);
								tr.find('input[postinput="unitprice"]').attr('retailPrice',GLOBALS['ProductList'][x].retailPrice);
								tr.find('input[postinput="unitprice"]').attr('purchasePrice',GLOBALS['ProductList'][x].purchasePrice);
								
								$('.salesBillingTd').find('input[postinput="unitprice"]').each(function(){
									if(!isNaN(parseInt($(this).val()))){
										$(this).val($(this).attr(PriceType));
										var parent 		= $(this).parent().parent().parent().parent(),
											subtotal	= parent.find('input[postInput="subtotal"]'),
											counts		= parent.find('input[postInput="counts"]');

										subtotal.val(counts.val() * $(this).val());
										statistics();
									}
								});
								// statistics();
								// payment();
								c++;
							}
						}
					}
				}
			}
		}

		setTimeout(function(){
			if($.Request("v") == "1"){
				isV();
			}
		},100);
	});
</script>

<!--数据提交-->
<script type="text/javascript">
	
	// 添加表单
	$('#salesBillingAddSaveButton').tap(function(){
		var cid 		= $('#salesBillingAddPostBox #customer').attr('did'),
			debtLimit  	= 0,
			arrears 	= 0,
			amount 		= parseInt($('#salesBillingAddPostBox #amount').val()),			// 应付
			actually 	= parseInt($('#salesBillingAddPostBox #actually').val());		// 实付

		for(var i in GLOBALS['CustomerList']){
			if(GLOBALS['CustomerList'][i].id == cid){
				debtLimit = parseInt(GLOBALS['CustomerList'][i].debtLimit);
				arrears   = parseInt(GLOBALS['CustomerList'][i].arrears);
			}
		}

		// 如果是散客
		if(actually < amount){
			if(debtLimit == 0){
				alert('错误','错误，用户欠款已达到设定额度，无法赊账');
				return false;
			}else{
				arrears = arrears + ( amount - actually );
				if(arrears > debtLimit){
					alert("错误",'错误，用户欠款已达到设定额度，无法赊账');
					return false;
				}
			}
		}


		//return false;

		$.mobile.loading('show');
		var postdata = postData($('#salesBillingAddPostBox'));
			postdata['types']		= 1;
			postdata['pricetype'] 	= PriceType;
		$.ajax({url: SERVER + "SalesForms/Add?token=" + TOKEN,
			data:postdata,
			type:'post',
			success: function(data){
				var result = eval("("+data+")");
				if(result.Status == 'ERROR'){
					alert(result.Status,result.Message);
					return;
				}

				// 添加入库的产品
				var formId = result.Result,
					list   = {},
					count  = 0;
				$('#salesBillingAddscrollBoxA tr').each(function(){

					if(!isNaN(parseInt($(this).find('input[postinput="subtotal"]').val()))){
						if(parseInt($(this).find('input[postinput="subtotal"]').val()) > 0){
							item = {}
							$(this).find('input').each(function(){
								item[$(this).attr('postInput')] = $(this).val();
							});
							var productInfo 	= $(this).find('input[postInput="product"]').val().split('/');
							item['formsid'] 	= formId;
							item['token'] 		= TOKEN;
							item['productcode'] = productInfo[1];
							item['productid']	= productInfo[0];
							item['product']		= productInfo[2];
							item['types']		= 1;
							item['pricetype'] 	= PriceType;
							item['customer']	= $('#salesBillingAddPostBox #customer').val();
							list[count] = item;
							count ++;
						}
					}
				});
				count = 0;
				
				// POST
				$.ajax({url: SERVER + "Sales/Add?token=" + TOKEN,
					data: list,
					type: 'post',
					success: function(data){
						var rst = eval("("+ data +")");

						// 更新客户端客户欠款信息
						if(rst.Status == 'SUCCESS'){
							//console.log('actually' + actually + '---amount' + amount);
							if(actually < amount){
								var v = parseFloat(amount) - parseFloat(actually);
								var k = "#qk_" + cid;
								var b = parseFloat($(k).attr('e'));
								$(k).text('欠款' + (v + b));
							}
						}

						alert(rst.Status,rst.Message);
						$.mobile.loading('hide');
					}
				});
			}
		});
	});
</script>

<script type="text/javascript">
	// 抹零
	$(function(){
		var tag = false;
		$('#moling_btn').tap(function(){
			var o = parseFloat($('#moling').val());
			if(tag){
				alert('错误','无法多次抹零');
				return false;
			}
			tag = true;
			if(isNaN(o)){
				alert('错误','输入错误');
				return false;
			}
			var y = parseFloat($('#salesBillingAddPostBox #amount').val());
			if(o > 50){
				alert("错误","不允许抹零大于50");
				return false;
			}
			$('#salesBillingAddPostBox #amount').val(y - o);
		});
	});
</script>

<script type="text/javascript">
	// 扫描开单

    function parseTdCode(data){
        result = data.split('|');
        var tb = $('#salesBillingAddscrollBoxA').find('table');
        tb.find('tr').each(function(){
            if($(this).find('input[postinput="product"]').val() == ''){
                $(this).find('input[postinput="product"]').val(result[0]);
                $(this).find('input[postinput="color"]').val(result[1]);
                $(this).find('input[postinput="size"]').val(result[2]);
                $(this).find('input[postinput="unitprice"]').val(result[3]);
                return false;
        	}
        });
    }

	$(function(){

		// 在这里调用二维码扫描插件代码，
		// 扫描完毕之后回调 parseTdCode(扫描的结果)
		$('#salesBillingAddScan').tap(function(){
			document.location="scan";
		});
	});
    
    function scan(){
        document.location="||scan";  //
        //parseTdCode("54/HESQQ2014/海尔斯泳装/|默认颜色|均码|50.00");
    }
</script>

</body>
</html>
